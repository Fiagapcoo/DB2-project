{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <style>
        .product-img {
            max-width: 100%;
            border-radius: 5px;
            cursor: pointer;
        }
        .thumb-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            cursor: pointer;
            border-radius: 5px;
        }
        .price {
            font-size: 2rem;
            font-weight: bold;
        }
        .original-price {
            text-decoration: line-through;
            color: red;
            margin-right: 10px;
        }
        .btn-add-cart {
            background-color: black !important;
            color: white !important;
            font-weight: bold !important;
        }
        .rating {
            color: gold;
        }
        .stock-status {
            font-weight: bold;
        }
        .in-stock {
            color: #198754;  /* Bootstrap success color */
        }
        .out-of-stock {
            color: #dc3545;  /* Bootstrap danger color */
        }
    </style>
{% endblock %}

{% block content %}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-6 product-images">
            <a href="{{ product.image_url }}" target="_blank">
                <div class="main-image">
                    <img src="{{ product.image_url }}" alt="Product Image">
                </div>
            </a>
        </div>

        <div class="col-md-6 product-details">
            <h2>{{ product.name }}</h2>
            <p><strong>Brand:</strong> Harley Benton</p>
            <div class="rating">â˜…â˜…â˜…â˜…â˜…</div>

            <p class="price mt-3">
                {% if product.discountedprice %}
                    <span class="original-price">â‚¬{{ product.baseprice }}</span>
                    <span id="discounted-price">â‚¬{{ product.discountedprice }}</span>
                {% else %}
                    <span id="original-price">â‚¬{{ product.baseprice }}</span>
                {% endif %}
            </p>

            <p>IVA incluÃ­do, â‚¬9,90 de portes de envio adicionais</p>

            {% if product.quantity > 0 %}
                <p class="stock-status in-stock">Em stock</p>
            {% else %}
                <p class="stock-status out-of-stock">Sem stock</p>
            {% endif %}

            <p>Entrega atÃ© aprox. <strong>Segunda, 3.02</strong></p>

            <button class="btn btn-add-cart w-100 p-2 add-to-cart" data-id="{{ product.productid }}"
                    {% if product.quantity <= 0 %}disabled{% endif %}>
                ADICIONAR AO CARRINHO
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function(event) {
            event.preventDefault();

            let productId = this.getAttribute('data-id');
            let url = `/add-to-cart/${productId}/`;

            console.log(`BotÃ£o clicado! Enviando requisiÃ§Ã£o para: ${url}`);

            fetch(url, {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("Resposta da API:", data);
                alert('Produto adicionado ao carrinho! ðŸ›’');

                let cartCountElement = document.getElementById('cart-count');
                if (cartCountElement) {
                    cartCountElement.innerText = data.cart.split(',').length;
                }
            })
            .catch(error => console.error('Erro ao adicionar ao carrinho:', error));
        });
    });
});
</script>
{% endblock %}
