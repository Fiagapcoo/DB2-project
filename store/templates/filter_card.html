{% load static %}

{% block extra_css %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="{% static 'filter_card/css/filter_card.css' %}">
<link rel="stylesheet" href="{% static '/css/filter_card.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="filter-card">
    
    <!-- Formulário para o Filtro -->
    <form method="GET" id="filter-form">
        <!-- Dropdown de Categorias -->
        <label for="categoria">Categoria</label>
        <select id="categoria" name="categoria" class="form-select" onchange="document.getElementById('filter-form').submit();">
            <option value="">Todas as Categorias</option>
            {% for categoria in categories %}
                <option value="{{ categoria.categoryid }}" {% if categoria.categoryid|stringformat:"s" == selected_category %}selected{% endif %}>
                    {{ categoria.name }}
                </option>
            {% endfor %}
        </select>
    
        <!-- Slider de Preço Dinâmico -->
        <label for="price-range" class="form-label">Preço</label>
        <div id="price-slider" class="mt-3" style="height: 10px;"></div>
    
        <div class="price-display mt-2">
            <input type="text" id="min-value" name="min_price" class="price-input" readonly value="{{ min_price }}">
            <span> - </span>
            <input type="text" id="max-value" name="max_price" class="price-input" readonly value="{{ max_price }}">
        </div>

        <!-- Filtro por Avaliação -->
        <label class="mt-3">Avaliação</label>
        <div class="rating-filter">
            <label class="rating-option">
                <input type="checkbox" name="rating" value="5" class="rating-checkbox">
                <span class="stars">
                    ★★★★☆
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="4" class="rating-checkbox">
                <span class="stars">
                    ★★★★☆
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="3" class="rating-checkbox">
                <span class="stars">
                    ★★★☆☆
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="2" class="rating-checkbox">
                <span class="stars">
                    ★★☆☆☆
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="1" class="rating-checkbox">
                <span class="stars">
                    ★☆☆☆☆
                </span>
            </label>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const priceSlider = document.getElementById('price-slider');

    if (priceSlider) {
        noUiSlider.create(priceSlider, {
            start: [300, 1200], 
            connect: true,
            range: { 'min': 0, 'max': 5000 },
            format: {
                to: (value) => `${Math.round(value)}€`,
                from: (value) => Number(value.replace('€', ''))
            }
        });

        const minValueDisplay = document.getElementById("min-value");
        const maxValueDisplay = document.getElementById("max-value");

        priceSlider.noUiSlider.on('update', function (values) {
            minValueDisplay.value = values[0];
            maxValueDisplay.value = values[1];
        });
    }
});

</script>
{% endblock %}
