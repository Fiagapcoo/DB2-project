{% load static %}

{% block extra_css %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="{% static 'filter_card/css/filter_card.css' %}">
<link rel="stylesheet" href="{% static '/css/filter_card.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="card shadow-sm p-3 mb-4 bg-white rounded filter-card">
        <h5 class="card-title text-center text-primary mb-3"><i class="bi bi-funnel"></i> Filtros</h5>
    
    <!-- FormulÃ¡rio para o Filtro -->
    <form method="GET" id="filter-form">
        <!-- Dropdown de Categorias -->
        <label for="categoria" class="form-label fw-bold">ðŸ“‚ Categoria</label>
        <select id="categoria" name="categoria" class="form-select" onchange="document.getElementById('filter-form').submit();">
            <option value="">Todas as Categorias</option>
            {% for categoria in categories %}
                <option value="{{ categoria.categoryid }}" {% if categoria.categoryid|stringformat:"s" == selected_category %}selected{% endif %}>
                    {{ categoria.name }}
                </option>
            {% endfor %}
        </select>
    
        <!-- Slider de PreÃ§o DinÃ¢mico -->
        <div class="mb-3">
            <label for="price-range" class="form-label fw-bold">ðŸ’° Faixa de PreÃ§o</label>
            <div id="price-slider" class="mt-2"></div>
            <div class="price-display d-flex justify-content-between mt-2">
                <input type="text" id="min-value" name="min_price" class="price-input form-control text-center fw-bold" readonly value="{{ min_price }}">
                <span class="fw-bold">-</span>
                <input type="text" id="max-value" name="max_price" class="price-input form-control text-center fw-bold" readonly value="{{ max_price }}">
            </div>
        </div>

        <!-- Filtro de Estoque 
        <div class="mb-3">
            <label class="form-label fw-bold">ðŸ“¦ Disponibilidade</label>
            <select id="stock" name="stock" class="form-select" onchange="document.getElementById('filter-form').submit();">
                <option value="">Todos</option>
                <option value="in_stock" {% if selected_stock == 'in_stock' %}selected{% endif %}>Em Estoque</option>
                <option value="out_of_stock" {% if selected_stock == 'out_of_stock' %}selected{% endif %}>Sem Estoque</option>
            </select>
        </div> -->

        <!-- BotÃ£o de Reset -->
        <div class="d-grid">
            <a href="{% url 'discount' %}" class="btn btn-secondary">ðŸ”„ Resetar Filtros</a>
        </div>

        <!-- Filtro por AvaliaÃ§Ã£o
        <label class="mt-3">AvaliaÃ§Ã£o</label>
        <div class="rating-filter">
            <label class="rating-option">
                <input type="checkbox" name="rating" value="5" class="rating-checkbox">
                <span class="stars">
                    â˜…â˜…â˜…â˜…â˜†
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="4" class="rating-checkbox">
                <span class="stars">
                    â˜…â˜…â˜…â˜…â˜†
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="3" class="rating-checkbox">
                <span class="stars">
                    â˜…â˜…â˜…â˜†â˜†
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="2" class="rating-checkbox">
                <span class="stars">
                    â˜…â˜…â˜†â˜†â˜†
                </span>
            </label>
            <label class="rating-option">
                <input type="checkbox" name="rating" value="1" class="rating-checkbox">
                <span class="stars">
                    â˜…â˜†â˜†â˜†â˜†
                </span>
            </label>
        </div>
        -->
        
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const priceSlider = document.getElementById('price-slider');

    if (priceSlider) {
        noUiSlider.create(priceSlider, {
            start: [300, 1200], 
            connect: true,
            range: { 'min': 0, 'max': 5000 },
            format: {
                to: (value) => `${Math.round(value)}â‚¬`,
                from: (value) => Number(value.replace('â‚¬', ''))
            }
        });

        const minValueDisplay = document.getElementById("min-value");
        const maxValueDisplay = document.getElementById("max-value");

        priceSlider.noUiSlider.on('update', function (values) {
            minValueDisplay.value = values[0];
            maxValueDisplay.value = values[1];
        });
    }
});

</script>
{% endblock %}
