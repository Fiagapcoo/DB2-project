{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'order_details/css/order_details.css' %}">
{% endblock %}

{% block content %}
    <div class="container mt-5">
        <h1 class="text-center mb-4">üì¶ Detalhes do Pedido</h1>

        {% if order %}
            <div class="card shadow-sm p-4">
                <h4 class="mb-3"><strong>C√≥digo da Transa√ß√£o:</strong> {{ order.transaction_code }}</h4>
                <h5>Status: 
                    {% if order.status == "Completed" %}
                        <span class="badge bg-success">‚úÖ Conclu√≠do</span>
                    {% elif order.status == "Pending" %}
                        <span class="badge bg-warning text-dark">‚è≥ Pendente</span>
                    {% else %}
                        <span class="badge bg-secondary">‚ùå Outro</span>
                    {% endif %}
                </h5>
                <h5><strong>Forma de Pagamento:</strong> {{ order.payment_method }}</h5>
                <h5><strong>Total Pago:</strong> <span class="text-primary fw-bold">‚Ç¨{{ order.amount }}</span></h5>
            </div>

            <div class="container mt-4 mb-5">
                <h2 class="mb-4">üõçÔ∏è Produtos Comprados</h2>
                <div class="d-flex flex-wrap gap-3 justify-content-center">
                    {% for item in order.items %}
                        <div class="product-card">
                            <img id="product-img-{{ item.product_id }}" alt="Produto">
                            <h5 id="product-name-{{ item.product_id }}">Carregando...</h5>
                            <div class="product-details">
                                <p class="product-quantity">Quantidade: {{ item.quantity }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="alert alert-warning text-center">
                <p>‚ö†Ô∏è Pedido n√£o encontrado.</p>
            </div>
        {% endif %}
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const productElements = document.querySelectorAll("[id^=product-name-]");

            productElements.forEach(el => {
                let productId = el.id.split("-")[2];
                
                fetch(`/get-product-info/${productId}/`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById(`product-name-${productId}`).textContent = data.name;
                        document.getElementById(`product-img-${productId}`).src = data.image_url;
                        document.getElementById(`product-price-${productId}`).textContent = data.price;
                    })
                    .catch(error => console.error("Erro ao buscar produto:", error));
            });
        });
    </script>
{% endblock %}
